# Role Distribution System

Система динамического распределения ситуационных ролей для agile-команд креативной сферы.

## Описание проекта

Веб-приложение автоматически распределяет 7 ситуационных ролей (Модератор, Спикер, Тайм-менеджер, Критик, Идеолог, Медиатор, Гармонизатор) среди участников встречи на основе:

- **Биоритмов** - хронотип и пик часов активности участника
- **Эмоционального интеллекта** (EI) - способность распознавать и управлять эмоциями
- **Социального интеллекта** (SI) - эффективность социального взаимодействия

Система использует детерминированный алгоритм с двумя валидаторами:
1. **Валидатор баланса нагрузки** - предотвращает повторение одних и тех же ролей
2. **Валидатор контекста встречи** - адаптирует приоритеты ролей под тип встречи

## Технологический стек

### Backend
- Python 3.11+
- FastAPI - современный веб-фреймворк
- SQLAlchemy - ORM
- PostgreSQL - база данных
- Alembic - миграции
- uv - менеджер зависимостей

### Frontend
- React 18 + TypeScript
- Vite - build tool
- React Router - маршрутизация
- Axios - HTTP клиент

## Быстрый старт

### Предварительные требования

- Python 3.11+
- Node.js 18+
- PostgreSQL 15+
- uv (установка: `pip install uv`)

### 1. Клонирование и setup

```bash
cd demo_code
```

### 2. Backend setup

```bash
cd backend

# Установка зависимостей
uv sync

# Создание базы данных
createdb role_distribution

# Настройка окружения
cp .env.example .env
# Отредактируйте .env с вашими настройками БД

# Применение миграций
uv run alembic upgrade head

# Заполнение тестовыми данными
uv run python seed_data.py

# Запуск сервера
uv run uvicorn app.main:app --reload
```

Backend будет доступен на `http://localhost:8000`
Swagger документация: `http://localhost:8000/docs`

### 3. Frontend setup

```bash
cd ../frontend

# Установка зависимостей
npm install

# Запуск development сервера
npm run dev
```

Frontend будет доступен на `http://localhost:5173`

## Структура проекта

```
demo_code/
├── backend/                 # Backend API
│   ├── app/
│   │   ├── constants/       # Роли и типы встреч (из ТЗ)
│   │   ├── models/          # SQLAlchemy модели
│   │   ├── schemas/         # Pydantic schemas
│   │   ├── routers/         # API endpoints
│   │   ├── services/        # Бизнес-логика алгоритма
│   │   ├── config.py
│   │   ├── database.py
│   │   └── main.py
│   ├── alembic/             # Миграции БД
│   ├── seed_data.py
│   └── pyproject.toml
│
├── frontend/                # Frontend приложение
│   ├── src/
│   │   ├── api/             # API клиенты
│   │   ├── pages/           # Страницы
│   │   ├── App.tsx
│   │   └── main.tsx
│   └── package.json
│
└── tech_task.md             # Техническое задание
```

## Основные возможности

### Управление участниками
- Добавление участников с параметрами (EI, SI, биоритмы)
- Просмотр и удаление участников

### Управление встречами
- Создание встреч с выбором типа:
  - Brainstorm
  - Review/Ретроспектива
  - Planning
  - Status Update
- Добавление участников к встрече
- Указание времени проведения

### Распределение ролей
- Автоматическое назначение 7 ролей:
  1. Модератор
  2. Спикер
  3. Тайм-менеджер
  4. Критик
  5. Идеолог
  6. Медиатор
  7. Гармонизатор
- Отображение fitness score для каждого назначения
- Учет истории ролей участника
- Адаптация под тип встречи

## Алгоритм распределения

### Этапы работы:

1. **Расчет энергии** - определение уровня энергии каждого участника на момент встречи на основе их хронотипа и пика активности

2. **Базовый fitness score** - оценка соответствия параметров участника (EI, SI, энергия) требованиям каждой роли

3. **Валидатор 1: История ролей**
   - 2 встречи подряд в одной роли → штраф -40%
   - 3 встречи подряд → штраф -70%
   - 4+ встреч подряд → исключение из кандидатов

4. **Валидатор 2: Контекст встречи**
   - Применение множителей в зависимости от типа встречи
   - Например, для Brainstorm усиливается важность Модератора (×1.5) и Идеолога (×1.5)

5. **Жадный алгоритм назначения**
   - Сортировка всех пар (участник, роль) по финальному score
   - Итеративное назначение с учетом ограничений
   - Детерминированность через tie-breaking по имени

## API Endpoints

### Participants
- `GET /api/participants` - список участников
- `POST /api/participants` - создать участника
- `DELETE /api/participants/{id}` - удалить

### Meetings
- `GET /api/meetings` - список встреч
- `POST /api/meetings` - создать встречу
- `GET /api/meetings/{id}` - детали встречи
- `POST /api/meetings/{id}/assign-roles` - **запустить алгоритм**
- `GET /api/meetings/{id}/assignments` - получить результаты

## Тестовые данные

После запуска `seed_data.py` в базе будут созданы:
- 10 тестовых участников с разными профилями (хронотипы, EI, SI)
- 3 встречи разных типов

## Следующие шаги

1. Откройте `http://localhost:5173` в браузере
2. Перейдите в "Participants" и ознакомьтесь с тестовыми участниками
3. Вернитесь в "Meetings" и откройте любую встречу
4. Нажмите "Assign Roles" для запуска алгоритма
5. Просмотрите результаты назначения ролей с fitness scores

## Разработка

- Backend документация: [backend/README.md](backend/README.md)
- Frontend документация: [frontend/README.md](frontend/README.md)
- Техническое задание: [tech_task.md](tech_task.md)

## Авторы

Проект создан на основе технического задания для системы динамического распределения ситуационных ролей в agile-командах.
